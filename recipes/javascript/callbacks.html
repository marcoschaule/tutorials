<!DOCTYPE html><html><head><meta charset="utf8"><title>Callbacks</title><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/tutorials/css/styles.css"><base href="/tutorials/"></head><body><div class="container" id="container"><header id="header"><div id="title"><a href="/tutorials/">Tutorials</a></div><div id="subtitle">Learning by Recipes.</div></header><nav id="navigation"><a href="/tutorials/">Home</a><a class="active" href="/tutorials/blog.html">Blog</a><a href="/tutorials/about.html">About</a><a href="/tutorials/contact.html">Contact</a></nav><main id="content"><div class="page-Callbacks"><h1>Callbacks</h1><p><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>JavaScript is an asynchronous language, that means, that some
native functions in javascript are executed outside of the
current context. For them not to <em>block</em> the rest of the application,
JavaScript uses the so called <strong>Event Loop</strong>. This loop registers
all function calls that are asynchronous and fires an event when
they are done. The event again calls the so called <strong>callback</strong>.
So in JavaScript, a <strong>callback</strong> is a function with ane important purpose:
to be called when an expected execution context of an asynchronous function
has finished.</p>
<p>Here is a list of asynchronous functions you can
use in javascript in a DOM environment:</p>
<ul>
<li><code>setInterval</code>,</li>
<li><code>setTimeout</code>,</li>
<li><code>XMLHttpRequest</code>,</li>
<li><code>WebSocket</code>,</li>
<li><code>Worker</code>,</li>
<li><code>requestAnimationFrame</code>,</li>
<li>some HTML5 APIs such as the File API, Web Database API etc.,</li>
<li>technologies that support <code>onload</code>,</li>
<li>and many others …</li>
</ul>
<p>Each function calling one of the functions above becomes
asynchronous itself. And each function calling that function becomes
asynchronous itself, too, and so on.</p>
<p>Let’s first take a look at a normal, synchronous function call:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str, getString, isString;</div><div class="line"></div><div class="line">getString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'someString'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">isString = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (<span class="string">'string'</span> === <span class="keyword">typeof</span> str);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// this works since there is not asynchronous function involved</span></div><div class="line">str = getString();</div><div class="line"><span class="comment">// this logs true</span></div><div class="line"><span class="built_in">console</span>.log(isString(str));</div></pre></td></tr></table></figure>
<p>In this code, the functions return simple values. This behavior is
synchronous. You can use them the expected way.
Let’s now look at a function, which itself calls an asynchronous
function, which makes itself asynchronous:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str, getString, isString;</div><div class="line"></div><div class="line">getString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> str;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 'setTimeout' works asynchronous</span></div><div class="line">    str = <span class="string">'someString'</span>;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> str;</div><div class="line">&#125;</div><div class="line"></div><div class="line">isString = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (<span class="string">'string'</span> === <span class="keyword">typeof</span> str);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// this doesn't work since the function returns the string before</span></div><div class="line"><span class="comment">// the 'setTimeout' is fired (the next tick of the event loop)</span></div><div class="line">str = getString(); </div><div class="line"><span class="comment">// this logs false, since it is undefined</span></div><div class="line"><span class="built_in">console</span>.log(isString(str));</div></pre></td></tr></table></figure>
<p>Ignoring the fact that <code>getString</code> is now asynchronous and threating
it the common synchronous way, the code fails. To solve this problem,
you can use callbacks. Callbacks are called at the end of an executing
context:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str, getString, isString;</div><div class="line"></div><div class="line">getString = <span class="function"><span class="keyword">function</span>(<span class="params">myCallback</span>) </span>&#123; <span class="comment">// function now has a callback function as a argument</span></div><div class="line">  <span class="keyword">var</span> str;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 'setTimeout' works asynchronously now</span></div><div class="line">    str = <span class="string">'someString'</span>;</div><div class="line">    myCallback(<span class="literal">null</span>, str); <span class="comment">// the callback is called instead of a return value</span></div><div class="line">  &#125;);</div><div class="line">  <span class="comment">// no return value necessary any more</span></div><div class="line">  <span class="comment">// return str;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">isString = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (<span class="string">'string'</span> === <span class="keyword">typeof</span> str);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// now we call the 'getString' function and give it a callback;</span></div><div class="line"><span class="comment">// within this callback, we can now have the string available</span></div><div class="line">getString(<span class="function"><span class="keyword">function</span>(<span class="params">err, str</span>)</span>&#123;</div><div class="line">  <span class="comment">// this logs true since the string is available here</span></div><div class="line">  <span class="built_in">console</span>.log(isString(str));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>To be more precise, the function given to the ‘getString’ function
is the callback definition (as a anonymous function expression):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">getString(<span class="function"><span class="keyword">function</span>(<span class="params">err, str</span>)</span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Here the callback is finally executed with the first error argument as <code>null</code>
and the second result string argument as <code>&#39;someString&#39;</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">myCallback(<span class="literal">null</span>, str);</div></pre></td></tr></table></figure>
<h2 id="Callsbacks-as-the-last-argument"><a href="#Callsbacks-as-the-last-argument" class="headerlink" title="Callsbacks as the last argument"></a>Callsbacks as the last argument</h2><p>Whenever possible you should use callbacks as the last argument. For instance:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// here is the callback the last argument</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params">arg1, arg2, callback</span>) </span>&#123;</div><div class="line">  <span class="comment">// some code here ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Error-as-the-callback’s-first-argument"><a href="#Error-as-the-callback’s-first-argument" class="headerlink" title="Error as the callback’s first argument"></a>Error as the callback’s first argument</h2><p>When calling callbacks, you should call them with the first
argument being a possible error, followed by any other argument. For instance:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// here is the callback the last argument</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params">arg1, arg2, callback</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> objErr, objResult;</div><div class="line">  </div><div class="line">  <span class="comment">// some code here ...</span></div><div class="line">  <span class="keyword">if</span> (errorHappened) &#123;</div><div class="line">    objErr = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Some error happened!'</span>);</div><div class="line">    <span class="keyword">return</span> callback(objErr, <span class="literal">null</span>);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// some more code here ...</span></div><div class="line">  objResult = &#123; <span class="attr">some</span>: <span class="string">'result'</span> &#125;;</div><div class="line">  <span class="comment">// some more code here ...</span></div><div class="line">  <span class="keyword">return</span> callback(<span class="literal">null</span>, objResult);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Callback-Hell-or-Pyramid-of-Doom"><a href="#Callback-Hell-or-Pyramid-of-Doom" class="headerlink" title="Callback Hell or Pyramid of Doom"></a>Callback Hell or Pyramid of Doom</h2><p>When working with callbacks, you can run into so called
<strong>callback hells</strong> or <strong>Pyramid of Doom</strong>.
The callback hell is the nested calling of callbacks.</p>
<p>For instance:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params">callback1</span>) </span>&#123;</div><div class="line">  <span class="comment">// do something ...</span></div><div class="line">  callback1(<span class="function"><span class="keyword">function</span>(<span class="params">callback2</span>) </span>&#123;</div><div class="line">    <span class="comment">// do something ...</span></div><div class="line">    callback2(<span class="function"><span class="keyword">function</span>(<span class="params">callback3</span>) </span>&#123;</div><div class="line">      <span class="comment">// do something ...</span></div><div class="line">      callback3(<span class="function"><span class="keyword">function</span>(<span class="params">callback4</span>) </span>&#123;</div><div class="line">        <span class="comment">// do something ...</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>To avoid callbacks, there are several methods. One of them to call the
following function by name within the current function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// define the functions to call each other:</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// do something ...</span></div><div class="line">  callback1();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// do something ...</span></div><div class="line">  callback2();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// do something ...</span></div><div class="line">  callback2();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback3</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// do something ...</span></div><div class="line">  callback4();</div><div class="line">&#125;</div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure>
<p>If you don’t <a href="recipes/javascript/hoisting.html">hoist</a> the functions, you
will have to define the functions in order of them getting called.</p>
<p>Another way to avoid callback hell are</p>
<ul>
<li>the <code>async</code> framework,</li>
<li><strong>Promises</strong>,</li>
<li>Reactice Programmen with <strong>RxJS</strong>, and</li>
<li>Fibers and Futures.</li>
</ul>
<h2 id="Callbacks-in-loops"><a href="#Callbacks-in-loops" class="headerlink" title="Callbacks in loops"></a>Callbacks in loops</h2><p>If you have to deal with asynchronous functions in loops, it gets a little bit
tricky. Since the loop doesn’t wait until the function has finished, the functions
in a loop are all fired and forgotten, ignoring any possible return value.</p>
<p>In the following (quite large) example, there are three asynchronous functions
that are called within a loop. The loop takes the result from each function and
adds it into a array of results. Finally, the array of results is logged, but it is
empty. How can that be?</p>
<p>Take a look:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> doSomethingAsync1, doSomethingAsync2, doSomethingAsync2,</div><div class="line">    arrDoFuncs, arrResults;</div><div class="line"></div><div class="line">doSomethingAsync1 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult1AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync2 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult2AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync3 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult3AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">arrDoFuncs = [doSomethingAsync1, doSomethingAsync2, doSomethingAsync3];</div><div class="line">arrResults = [];</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrDoFuncs.length; i += <span class="number">1</span>) &#123;</div><div class="line">  <span class="keyword">var</span> doSomethingAsyncCurrent = arrDoFuncs[i];</div><div class="line">  doSomethingAsyncCurrent(<span class="function"><span class="keyword">function</span>(<span class="params">objErr, strResult</span>)</span>&#123;</div><div class="line">    arrResults.push(strResult);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// this logs '[]', an empty array</span></div><div class="line"><span class="built_in">console</span>.log(arrResults);</div></pre></td></tr></table></figure>
<p>The reason why the <code>arrResults</code> is empty, is because the loop fires each function
and continues, but the callback of the function is each fired later - when the loop
<em>and</em> the logging have finished.</p>
<p>To compensate that behavior, you need to use a common callback, which checks for each
call whether all callbacks have finished.</p>
<p>Here the improved example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> doSomethingAsync1, doSomethingAsync2, doSomethingAsync2,</div><div class="line">    commonCallback, arrDoFuncs, arrResults;</div><div class="line"></div><div class="line">doSomethingAsync1 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult1AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync2 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult2AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync3 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult3AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">arrDoFuncs = [doSomethingAsync1, doSomethingAsync2, doSomethingAsync3];</div><div class="line">arrResults = [];</div><div class="line"></div><div class="line"><span class="comment">// add the callback that is used by each loop iteration</span></div><div class="line">commonCallback = <span class="function"><span class="keyword">function</span>(<span class="params">objErr, strResult</span>) </span>&#123;</div><div class="line">  arrResults.push(strResult);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (arrResults.length &gt;= arrDoFuncs.length) &#123;</div><div class="line">    <span class="comment">// this logs the finalized array</span></div><div class="line">    <span class="built_in">console</span>.log(arrResults);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrDoFuncs.length; i += <span class="number">1</span>) &#123;</div><div class="line">  <span class="keyword">var</span> doSomethingAsyncCurrent = arrDoFuncs[i];</div><div class="line">  doSomethingAsyncCurrent(commonCallback);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>As you can see, the order of application as well as the order of the
code is destroyed, but the code works now. To put the code in order
for developers to read it from top to bottom, you can use the
<a href="recipes/javascript/hoisting.html">function hoisting</a>.</p>
<p>Here the final version of the example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> doSomethingAsync1, doSomethingAsync2, doSomethingAsync2,</div><div class="line">    <span class="comment">/* commonCallback */</span>, arrDoFuncs, arrResults;</div><div class="line"></div><div class="line">doSomethingAsync1 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult1AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync2 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult2AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line">doSomethingAsync3 = <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    callback(<span class="literal">null</span>, <span class="string">'someResult3AsString'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">arrDoFuncs = [doSomethingAsync1, doSomethingAsync2, doSomethingAsync3];</div><div class="line">arrResults = [];</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrDoFuncs.length; i += <span class="number">1</span>) &#123;</div><div class="line">  <span class="keyword">var</span> doSomethingAsyncCurrent = arrDoFuncs[i];</div><div class="line">  doSomethingAsyncCurrent(commonCallback);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">commonCallback</span>(<span class="params">objErr, strResult</span>) </span>&#123;</div><div class="line">  arrResults.push(strResult);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (arrResults.length &gt;= arrDoFuncs.length) &#123;</div><div class="line">    <span class="comment">// this logs the finalized array</span></div><div class="line">    <span class="built_in">console</span>.log(arrResults);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The code still shifts to the left, but at least it reads from top to bottom.
The shifting is something you can’t avoid that behavior in JavaScript.</p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links:"></a>Links:</h2><ul>
<li><a href="http://www.w3schools.com/js/js_hoisting.asp" target="_blank" rel="external">JavaScript Declarations are hoisted (w3scools.com)</a></li>
<li><a href="https://developer.mozilla.org/de/docs/Glossary/Hoisting" target="_blank" rel="external">Hoisting (MDN)</a></li>
<li><a href="http://adripofjavascript.com/blog/drips/variable-and-function-hoisting" target="_blank" rel="external">Variable and function hoisting</a></li>
</ul>
<h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><ul>
<li><em>Do</em> write the callback as the last argument of an async function
definition.</li>
<li><em>Do</em> use <strong>one</strong> callback if possible.</li>
<li><em>Do</em> set the first callback parameter to be the error object!</li>
<li><em>Do</em> avoid function hoisting whenever possible.</li>
</ul>
</p></div></main><footer id="footer"><hr>&copy; by Marco Schaule
&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;<a href="/tutorials/imprint.html" title="Imprint">Imprint</a></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script><script src="/tutorials/scripts/scripts.js"></script></body></html>